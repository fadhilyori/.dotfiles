# shellcheck shell=bash
# Custom dotfiles configuration

# Custom PATH additions
export PATH="$HOME/bin:$HOME/.local/bin:$PATH"

# Node.js options
export NODE_OPTIONS="--max-old-space-size=4096"

# FZF settings
export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border'
export FZF_COMPLETION_TRIGGER='~~'
export FZF_COMPLETION_OPTS='--border --info=inline'
export FZF_COMPLETION_PATH_OPTS='--walker file,dir,follow,hidden'
export FZF_COMPLETION_DIR_OPTS='--walker dir,follow'

_fzf_comprun() {
  local command=$1
  shift

  case "$command" in
    cd)           fzf --preview '[ -d {} ] && (command -v tree >/dev/null && tree -C {} | head -200 || ls -la {})' "$@" ;;
    export|unset) fzf --preview "echo \"\${!{}:-<unset>}\"" "$@" ;;
    ssh)          fzf --preview 'dig {}'                   "$@" ;;
    *)            fzf --preview '(command -v bat >/dev/null && bat -n --color=always {} || command -v batcat >/dev/null && batcat -n --color=always {} || cat {}) 2>/dev/null' "$@" ;;
  esac
}

# Set up fzf key bindings and fuzzy completion (only if fzf is available)
if command -v fzf >/dev/null 2>&1; then
    eval "$(fzf --bash)"
fi

# Load all aliases immediately (simple and reliable)
if [ -d "$HOME/.dotfiles/.aliases.d" ]; then
    for f in "$HOME/.dotfiles/.aliases.d"/*.alias; do
        # shellcheck source=*
        [ -f "$f" ] && . "$f"
    done
fi

