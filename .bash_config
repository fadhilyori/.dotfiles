# shellcheck shell=bash
# Custom dotfiles configuration

# Custom PATH additions
export PATH="$HOME/bin:$HOME/.local/bin:$PATH"

# Node.js options
export NODE_OPTIONS="--max-old-space-size=4096"

# FZF settings
export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border'
export FZF_COMPLETION_TRIGGER='~~'
export FZF_COMPLETION_OPTS='--border --info=inline'
export FZF_COMPLETION_PATH_OPTS='--walker file,dir,follow,hidden'
export FZF_COMPLETION_DIR_OPTS='--walker dir,follow'

_fzf_comprun() {
  local command=$1
  shift

  case "$command" in
    cd)           fzf --preview 'tree -C {} | head -200'   "$@" ;;
    export|unset) fzf --preview "echo \"\${!{}:-<unset>}\"" "$@" ;;
    ssh)          fzf --preview 'dig {}'                   "$@" ;;
    *)            fzf --preview 'bat -n --color=always {}' "$@" ;;
  esac
}

# Set up fzf key bindings and fuzzy completion (only if fzf is available)
if command -v fzf >/dev/null 2>&1; then
    eval "$(fzf --bash)"
fi

# Load all aliases immediately (simple and reliable)
if [ -d "$(dirname "${BASH_SOURCE[0]}")/.aliases.d" ]; then
    for f in "$(dirname "${BASH_SOURCE[0]}")/.aliases.d"/*; do
        # shellcheck source=*
        [ -f "$f" ] && . "$f"
    done
fi

